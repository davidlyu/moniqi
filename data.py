import json
from scipy.stats import norm as norm_module


class Data:
    def __init__(self):
        self._param = {}

    def __getitem__(self, key):
        return self._param[key]

    def __setitem__(self, key, value):
        self._param[key] = value

    def read_params(self):
        try:
            with open(self._param['name'] + 'data.json', 'r') as f:
                self._param = json.loads(f.read())
        except FileNotFoundError:
            with open(self._param['name'] + 'data.json', 'w') as f:
                f.write(json.dumps(self._param))


class ReaData(Data):
    def __init__(self):
        Data.__init__(self)
        boron_value = [
            (2000, -9.75),
            (1500, -10.54),
            (1000, -11.47),
            (500, -12.55),
            (10, -13.78),
        ]
        self._param = dict(
            name='rea',
            loop_bc=1178,
            tank_bc=7000,
            rcp_vol=199,
            dilute_vol=0,
            dilute_rate=0,
            boron_vol=0,
            boron_rate=0,
            delta_rho=0,
            is_dilute_active=False,
            is_boron_active=False,
            boron_value=boron_value,
            boron_rate_half_time=1,
            dilute_rate_half_time=1,
        )
        self.read_params()


class KicData(Data):
    def __init__(self):
        Data.__init__(self)
        self._param = dict(
            name='kic',
            irc1=1,
            irc2=1,
            src1=1,
            src2=1,
            # unit %FP
            core_power=0.01,
            irc1a2fp=3.5E4,
            irc2a2fp=3.5E4,
            src1cps2fp=1.0E-8,
            src2cps2fp=1.0E-8,
            src1_accuracy=0.01,
            src2_accuracy=0.01,
            irc1_accuracy=0.01,
            irc2_accuracy=0.01
        )
        self.read_params()


class ReacData(Data):
    def __init__(self):
        Data.__init__(self)
        beta = [
            (0.000217, 0.0125),
            (0.001470, 0.0308),
            (0.001359, 0.1147),
            (0.002835, 0.3102),
            (0.000965, 1.2305),
            (0.000326, 3.2824),
        ]
        self._param = dict(
            name='reac',
            reactivity=0,
            double_time=9999,
            beta=beta,
            neutron_life=26.98E-6,
            reactivity_accuracy=1
        )
        self.read_params()


class RglData(Data):
    def __init__(self):
        Data.__init__(self)
        r_value = [
            (225, 0.00),
            (220, 0.16),
            (215, 0.34),
            (211, 0.58),
            (206, 0.86),
            (201, 1.15),
            (196, 1.45),
            (191, 1.75),
            (186, 2.05),
            (182, 2.35),
            (177, 2.66),
            (172, 2.96),
            (167, 3.26),
            (162, 3.58),
            (157, 3.90),
            (153, 4.23),
            (148, 4.58),
            (143, 4.95),
            (138, 5.34),
            (133, 5.75),
            (128, 6.19),
            (124, 6.66),
            (119, 7.17),
            (114, 7.70),
            (109, 8.26),
            (104, 8.86),
            (99, 9.48),
            (95, 10.12),
            (90, 10.77),
            (85, 11.39),
            (80, 11.98),
            (75, 12.48),
            (71, 12.82),
            (66, 12.95),
            (61, 12.77),
            (56, 12.22),
            (51, 11.28),
            (46, 9.97),
            (42, 8.43),
            (37, 6.82),
            (32, 5.29),
            (27, 3.94),
            (22, 2.83),
            (17, 1.95),
            (13, 1.29),
            (8, 0.79),
            (5, 0.53),
        ]
        g1_value = [
            (225, 0.00),
            (218, 0.05),
            (211, 0.15),
            (203, 0.29),
            (196, 0.46),
            (189, 0.65),
            (182, 0.86),
            (174, 1.08),
            (167, 1.31),
            (160, 1.54),
            (153, 1.77),
            (145, 2.00),
            (138, 2.22),
            (131, 2.44),
            (124, 2.65),
            (116, 2.84),
            (109, 3.00),
            (102, 3.12),
            (95, 3.19),
            (87, 3.21),
            (80, 3.16),
            (73, 3.02),
            (66, 2.80),
            (58, 2.51),
            (51, 2.16),
            (44, 1.79),
            (37, 1.41),
            (29, 1.05),
            (22, 0.73),
            (15, 0.47),
            (8, 0.26),
            (5, 0.17),
        ]
        g2_value = [
            (225, 0.00),
            (220, 0.08),
            (215, 0.21),
            (211, 0.37),
            (206, 0.57),
            (201, 0.79),
            (196, 1.02),
            (191, 1.26),
            (186, 1.51),
            (182, 1.77),
            (177, 2.03),
            (172, 2.28),
            (167, 2.54),
            (162, 2.81),
            (157, 3.08),
            (153, 3.35),
            (148, 3.64),
            (143, 3.93),
            (138, 4.23),
            (133, 4.55),
            (128, 4.87),
            (124, 5.21),
            (119, 5.56),
            (114, 5.92),
            (109, 6.28),
            (104, 6.65),
            (99, 7.01),
            (95, 7.36),
            (90, 7.67),
            (85, 7.94),
            (80, 8.15),
            (75, 8.27),
            (71, 8.26),
            (66, 8.10),
            (61, 7.78),
            (56, 7.28),
            (51, 6.61),
            (46, 5.83),
            (42, 4.98),
            (37, 4.12),
            (32, 3.30),
            (27, 2.55),
            (22, 1.91),
            (17, 1.38),
            (13, 0.94),
            (8, 0.60),
            (5, 0.40),
        ]
        n1_value = [
            (225, 0.00),
            (220, 0.15),
            (215, 0.32),
            (211, 0.54),
            (206, 0.78),
            (201, 1.04),
            (196, 1.31),
            (191, 1.57),
            (186, 1.83),
            (182, 2.09),
            (177, 2.36),
            (172, 2.63),
            (167, 2.90),
            (162, 3.17),
            (157, 3.45),
            (153, 3.74),
            (148, 4.04),
            (143, 4.35),
            (138, 4.68),
            (133, 5.03),
            (128, 5.40),
            (124, 5.77),
            (119, 6.18),
            (114, 6.59),
            (109, 7.02),
            (104, 7.46),
            (99, 7.90),
            (95, 8.32),
            (90, 8.72),
            (85, 9.06),
            (80, 9.33),
            (75, 9.46),
            (71, 9.44),
            (66, 9.22),
            (61, 8.76),
            (56, 8.08),
            (51, 7.20),
            (46, 6.18),
            (42, 5.13),
            (37, 4.11),
            (32, 3.19),
            (27, 2.39),
            (22, 1.74),
            (17, 1.22),
            (13, 0.81),
            (8, 0.51),
            (5, 0.34),
        ]
        n2_value = [
            (225, 0.00),
            (220, 0.11),
            (215, 0.23),
            (211, 0.39),
            (206, 0.56),
            (201, 0.74),
            (196, 0.91),
            (191, 1.08),
            (186, 1.24),
            (182, 1.41),
            (177, 1.57),
            (172, 1.73),
            (167, 1.89),
            (162, 2.06),
            (157, 2.24),
            (153, 2.42),
            (148, 2.62),
            (143, 2.83),
            (138, 3.05),
            (133, 3.29),
            (128, 3.55),
            (124, 3.83),
            (119, 4.13),
            (114, 4.46),
            (109, 4.82),
            (104, 5.21),
            (99, 5.62),
            (95, 6.06),
            (90, 6.51),
            (85, 6.99),
            (80, 7.45),
            (75, 7.89),
            (71, 8.27),
            (66, 8.53),
            (61, 8.60),
            (56, 8.40),
            (51, 7.88),
            (46, 7.02),
            (42, 5.92),
            (37, 4.71),
            (32, 3.56),
            (27, 2.58),
            (22, 1.80),
            (17, 1.22),
            (13, 0.78),
            (8, 0.47),
            (5, 0.31),
        ]
        sa_value = [
            (225, 0.00),
            (218, 0.03),
            (211, 0.07),
            (203, 0.10),
            (196, 0.13),
            (189, 0.20),
            (182, 0.26),
            (174, 0.33),
            (167, 0.40),
            (160, 0.46),
            (153, 0.56),
            (145, 0.63),
            (138, 0.66),
            (131, 0.73),
            (124, 0.76),
            (116, 0.79),
            (109, 0.83),
            (102, 0.83),
            (95, 0.83),
            (87, 0.83),
            (80, 0.79),
            (73, 0.73),
            (66, 0.69),
            (58, 0.63),
            (51, 0.56),
            (44, 0.50),
            (37, 0.43),
            (29, 0.36),
            (22, 0.30),
            (15, 0.23),
            (8, 0.17),
            (5, 0.17),
        ]
        sb_value = [
            (225, 0.00),
            (220, 0.15),
            (215, 0.29),
            (211, 0.46),
            (206, 0.63),
            (201, 0.80),
            (196, 0.95),
            (191, 1.09),
            (186, 1.22),
            (182, 1.36),
            (177, 1.49),
            (172, 1.62),
            (167, 1.76),
            (162, 1.89),
            (157, 2.05),
            (153, 2.20),
            (148, 2.38),
            (143, 2.56),
            (138, 2.77),
            (133, 2.99),
            (128, 3.24),
            (124, 3.51),
            (119, 3.81),
            (114, 4.14),
            (109, 4.51),
            (104, 4.92),
            (99, 5.39),
            (95, 5.91),
            (90, 6.49),
            (85, 7.15),
            (80, 7.88),
            (75, 8.70),
            (71, 9.61),
            (66, 10.62),
            (61, 11.71),
            (56, 12.86),
            (51, 14.01),
            (46, 15.06),
            (42, 15.77),
            (37, 15.78),
            (32, 14.65),
            (27, 12.14),
            (22, 8.79),
            (17, 5.66),
            (13, 3.40),
            (8, 1.96),
            (5, 1.28),
        ]
        sc_value = [
            (225, 0.00),
            (220, 0.09),
            (215, 0.20),
            (211, 0.32),
            (206, 0.47),
            (201, 0.63),
            (196, 0.79),
            (191, 0.95),
            (186, 1.12),
            (182, 1.29),
            (177, 1.46),
            (172, 1.63),
            (167, 1.80),
            (162, 1.99),
            (157, 2.16),
            (153, 2.34),
            (148, 2.53),
            (143, 2.73),
            (138, 2.94),
            (133, 3.15),
            (128, 3.37),
            (124, 3.61),
            (119, 3.85),
            (114, 4.10),
            (109, 4.36),
            (104, 4.63),
            (99, 4.91),
            (95, 5.17),
            (90, 5.43),
            (85, 5.66),
            (80, 5.87),
            (75, 6.02),
            (71, 6.11),
            (66, 6.09),
            (61, 5.97),
            (56, 5.72),
            (51, 5.32),
            (46, 4.81),
            (42, 4.22),
            (37, 3.58),
            (32, 2.94),
            (27, 2.33),
            (22, 1.80),
            (17, 1.34),
            (13, 0.95),
            (8, 0.64),
            (5, 0.47),
        ]
        sd_value = [
            (225, 0.00),
            (220, 0.17),
            (215, 0.32),
            (211, 0.51),
            (206, 0.71),
            (201, 0.90),
            (196, 1.10),
            (191, 1.28),
            (186, 1.47),
            (182, 1.65),
            (177, 1.84),
            (172, 2.03),
            (167, 2.21),
            (162, 2.41),
            (157, 2.61),
            (153, 2.82),
            (148, 3.04),
            (143, 3.27),
            (138, 3.52),
            (133, 3.78),
            (128, 4.07),
            (124, 4.36),
            (119, 4.68),
            (114, 5.02),
            (109, 5.37),
            (104, 5.74),
            (99, 6.13),
            (95, 6.51),
            (90, 6.91),
            (85, 7.26),
            (80, 7.60),
            (75, 7.87),
            (71, 8.03),
            (66, 8.05),
            (61, 7.87),
            (56, 7.46),
            (51, 6.84),
            (46, 6.02),
            (42, 5.08),
            (37, 4.13),
            (32, 3.23),
            (27, 2.45),
            (22, 1.79),
            (17, 1.28),
            (13, 0.87),
            (8, 0.57),
            (5, 0.40),
        ]
        g_value = [
            (615, 0.00),
            (610, 0.04),
            (605, 0.10),
            (600, 0.18),
            (595, 0.28),
            (589, 0.40),
            (584, 0.53),
            (579, 0.68),
            (574, 0.82),
            (569, 0.98),
            (564, 1.13),
            (559, 1.29),
            (554, 1.45),
            (549, 1.61),
            (543, 1.78),
            (538, 1.93),
            (533, 2.10),
            (528, 2.26),
            (523, 2.41),
            (518, 2.57),
            (513, 2.71),
            (508, 2.84),
            (503, 2.96),
            (497, 3.06),
            (492, 3.13),
            (487, 3.20),
            (482, 3.31),
            (477, 3.41),
            (472, 3.51),
            (467, 3.62),
            (462, 3.72),
            (457, 3.82),
            (451, 3.92),
            (446, 4.01),
            (441, 4.09),
            (436, 4.18),
            (431, 4.26),
            (426, 4.34),
            (421, 4.41),
            (416, 4.50),
            (411, 4.61),
            (405, 4.73),
            (400, 4.87),
            (395, 5.06),
            (390, 5.10),
            (385, 5.44),
            (380, 5.82),
            (375, 6.20),
            (370, 6.60),
            (365, 6.99),
            (359, 7.37),
            (354, 7.71),
            (349, 8.05),
            (344, 8.34),
            (339, 8.55),
            (334, 8.68),
            (329, 8.69),
            (324, 8.58),
            (319, 8.37),
        ]

        self._param = dict(
            name='rgl',
            rpos=191,
            sapos=225,
            sbpos=225,
            scpos=225,
            sdpos=225,
            g1pos=225,
            g2pos=225,
            n1pos=225,
            n2pos=225,
            gpos=225,
            temp_target=191,
            power_target=225,
            delta_rho=0,
            current_temp_rod='R',
            current_power_rod='G1',
            is_temp_active=False,
            is_power_active=False,
            r_value=r_value,
            g1_value=g1_value,
            g2_value=g2_value,
            n1_value=n1_value,
            n2_value=n2_value,
            sa_value=sa_value,
            sb_value=sb_value,
            sc_value=sc_value,
            sd_value=sd_value,
            g_value=g_value,
            rod_value_accuracy=0.05
        )
        self.read_params()
